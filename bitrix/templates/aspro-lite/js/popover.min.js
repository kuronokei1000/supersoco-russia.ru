void 0===window.JxPopover&&(window.JxPopover=function(toggleNode,options){toggleNode="object"==typeof toggleNode&&toggleNode&&toggleNode instanceof Node?toggleNode:null,options="object"==typeof options&&options?options:{},this.toggleNode=toggleNode;var _private={inited:!1};let _options=JSON.stringify(options);Object.defineProperties(this,{inited:{get:function(){return _private.inited},set:function(value){value&&(_private.inited=!0)}},options:{get:function(){return JSON.parse(_options)}}}),this.init()},window.JxPopover.prototype={node:null,toggleNode:null,drag:null,overlay:null,get visible(){return this.node&&BX.hasClass(this.node,"show")},get trigger(){let tmp=this.options.trigger;if("string"==typeof tmp&&(tmp=tmp.split(",")),"object"==typeof tmp&&tmp&&tmp.length)for(let i=0,cnt=tmp.length;i<cnt;++i)tmp[i]=tmp[i].trim();else tmp=[];let trigger=[];return-1!==tmp.indexOf("click")&&trigger.push("click"),-1!==tmp.indexOf("hover")&&trigger.push("hover"),trigger.length||trigger.push("click"),trigger},get placement(){let tmp=this.options.placement,placement;return tmp="string"==typeof tmp?tmp.split(","):"object"==typeof tmp&&tmp&&tmp.length?[tmp[0],tmp[1]]:["top",""],[-1!==tmp.indexOf("bottom")?"bottom":-1!==tmp.indexOf("top")?"top":"",-1!==tmp.indexOf("right")?"right":-1!==tmp.indexOf("left")?"left":""]},get offset(){let tmp=this.options.offset,offset;return tmp="string"==typeof tmp?tmp.split(","):"object"==typeof tmp&&tmp&&tmp.length?[tmp[0],tmp[1]]:[0,0],["string"==typeof tmp[0]?tmp[0]:0,"string"==typeof tmp[1]?tmp[1]:0]},get sticky(){let tmp=this.options.sticky,sticky;return"boolean"!=typeof tmp||tmp},init:function(){this.inited||(this.inited=!0,this.toggleNode.xpopover=this,this.delayedHide.cnt=0,this.delayedHide.timer=!1,this.setPosition.timer=!1,this.resetPosition())},bindEvents:function(){-1!==this.trigger.indexOf("hover")&&("function"==typeof this.handlers.onLeave&&(BX.bind(this.toggleNode,"mouseleave",BX.proxy(this.handlers.onLeave,this)),BX.bind(this.node,"mouseleave",BX.proxy(this.handlers.onLeave,this))),"function"==typeof this.handlers.onEnter&&(BX.bind(this.toggleNode,"mouseenter",BX.proxy(this.handlers.onEnter,this)),BX.bind(this.node,"mouseenter",BX.proxy(this.handlers.onEnter,this)))),window.JxPopover.isTouch()&&(BX.bind(this.node,"touchstart",BX.proxy(this.handlers.onTouchStart,this)),BX.bind(this.node,"touchmove",BX.proxy(this.handlers.onTouchMove,this)),BX.bind(this.node,"touchend",BX.proxy(this.handlers.onTouchEnd,this)),BX.bind(this.node,"touchcancel",BX.proxy(this.handlers.onTouchCancel,this)))},unbindEvents:function(){-1!==this.trigger.indexOf("hover")&&("function"==typeof this.handlers.onLeave&&(BX.unbind(this.toggleNode,"mouseleave",BX.proxy(this.handlers.onLeave,this)),BX.unbind(this.node,"mouseleave",BX.proxy(this.handlers.onLeave,this))),"function"==typeof this.handlers.onEnter&&(BX.unbind(this.toggleNode,"mouseenter",BX.proxy(this.handlers.onEnter,this)),BX.unbind(this.node,"mouseenter",BX.proxy(this.handlers.onEnter,this)))),window.JxPopover.isTouch()&&(BX.unbind(this.node,"touchstart",BX.proxy(this.handlers.onTouchStart,this)),BX.unbind(this.node,"touchmove",BX.proxy(this.handlers.onTouchMove,this)),BX.unbind(this.node,"touchend",BX.proxy(this.handlers.onTouchEnd,this)),BX.unbind(this.node,"touchcancel",BX.proxy(this.handlers.onTouchCancel,this)))},append:function(){let translateX="center"===this.offset[0]?"-50%":this.offset[0],translateY="center"===this.offset[1]?"-50%":this.offset[1];this.node=BX.create({tag:"div",attrs:{class:"xpopover"},style:{transform:"translate("+translateX+","+translateY+")"}}),this.drag=BX.create({tag:"div",attrs:{class:"xpopover-drag"}}),this.node.append(this.drag);let content=this.getContent();content&&this.node.append(content),this.node.xpopover=this,BX.append(this.node,document.body)},show:function(){this.visible||(window.JxPopover.hide(),this.resetPosition(),this.node||this.append(),this.node&&(this.bindEvents(),this.setPosition(!0),BX.addClass(this.node,"show"),this.setPosition.timer&&clearInterval(this.setPosition.timer),this.setPosition.timer=setInterval(()=>{this.setPosition()},200)))},hide:function(){this.visible&&(this.setPosition.timer&&(clearTimeout(this.setPosition.timer),this.setPosition.timer=!1),this.resetPosition(),this.removeOverlay(),this.unbindEvents(),BX.removeClass(this.node,"show"),setTimeout(()=>{BX.remove(this.node),this.node=null},200))},toggle:function(){this.visible?this.hide():this.show()},delayedHide:function(){this.delayedHide.cnt>0?(clearTimeout(this.delayedHide.timer),this.delayedHide.timer=!1):(this.delayedHide.cnt=0,this.delayedHide.timer||(this.delayedHide.timer=setTimeout(()=>{this.hide(),this.delayedHide.timer=!1,this.delayedHide.cnt=0},1e3)))},position:{real:{left:null,top:null},applyed:{left:null,top:null,ww:null,wh:null,changed:!1},calculated:{left:null,top:null,ww:null,wh:null,changed:!1},last:{left:null,top:null,ww:null,wh:null}},resetPosition:function(){this.position={real:{left:null,top:null},applyed:{left:null,top:null,ww:null,wh:null,changed:!1},calculated:{left:null,top:null,ww:null,wh:null,changed:!1},last:{left:null,top:null,ww:null,wh:null}}},calcPosition:function(){if(this.toggleNode&&this.node){let toggleNodeOffset=this.toggleNode.getBoundingClientRect();this.position.calculated.left=parseInt(toggleNodeOffset.left+("right"===this.placement[1]?toggleNodeOffset.width:"left"===this.placement[1]?-1*this.node.offsetWidth:0)),this.position.calculated.top=parseInt(toggleNodeOffset.top+("bottom"===this.placement[0]?toggleNodeOffset.height:"top"===this.placement[0]?-1*this.node.offsetHeight:0)),this.position.calculated.ww=document.body.offsetWidth,this.position.calculated.wh=window.innerHeight,this.position.calculated.changed=this.position.calculated.top!==this.position.last.top||this.position.calculated.left!==this.position.last.left||this.position.calculated.wh!==this.position.last.wh||this.position.calculated.ww!==this.position.last.ww,this.position.applyed.changed=this.position.calculated.top!==this.position.applyed.top||this.position.calculated.left!==this.position.applyed.left||this.position.calculated.wh!==this.position.applyed.wh||this.position.calculated.ww!==this.position.applyed.ww}},swapPosition:function(){this.position.last.left=this.position.calculated.left,this.position.last.top=this.position.calculated.top,this.position.last.ww=this.position.calculated.ww,this.position.last.wh=this.position.calculated.wh},setPosition:function(force=!1){this.toggleNode&&null!==this.toggleNode.offsetParent?!this.node||!force&&window.JxPopover.skipSetPosition||(window.JxPopover.isMobile()?this.addOverlay():(this.removeOverlay(),this.calcPosition(),this.position.calculated.changed&&(this.swapPosition(),force?this.sticky?this.applyStickyPosition():this.applyPosition():this.hide()))):this.hide()},applyPosition:function(left=null,top=null){this.node&&(this.position.real.left=null!=left?left:this.position.calculated.left,this.position.real.top=void 0!==top&&null!=top?top:this.position.calculated.top,BX.style(this.node,"left",this.position.real.left+"px"),BX.style(this.node,"top",this.position.real.top+"px"),this.position.applyed.left=this.position.calculated.left,this.position.applyed.top=this.position.calculated.top,this.position.applyed.ww=this.position.calculated.ww,this.position.applyed.wh=this.position.calculated.wh)},applyStickyPosition:function(){if(this.sticky&&this.toggleNode&&this.node&&!window.JxPopover.isMobile()){this.calcPosition();let clone=this.node.cloneNode(!0);clone.classList.add("clone"),clone.style.left=this.position.calculated.left+"px",clone.style.top=this.position.calculated.top+"px",BX.append(clone,document.body);let cloneOffset=clone.getBoundingClientRect();cloneOffset={x:Math.round(cloneOffset.x),left:Math.round(cloneOffset.x),right:Math.round(cloneOffset.x+cloneOffset.width),y:Math.round(cloneOffset.y),top:Math.round(cloneOffset.y),bottom:Math.round(cloneOffset.y+cloneOffset.height)};let left=parseInt(clone.style.left);left=isNaN(left)?0:left,cloneOffset.x<=0?left+=-1*cloneOffset.x:cloneOffset.right>=document.body.offsetWidth&&(left-=cloneOffset.right-document.body.offsetWidth);let top=parseInt(clone.style.top);top=isNaN(top)?0:top,cloneOffset.y<=0?top+=-1*cloneOffset.y:cloneOffset.bottom>=window.innerHeight&&(top-=cloneOffset.bottom-window.innerHeight),clone.remove(),this.applyPosition(left,top)}},getContent:function(){if(this.toggleNode){let template=this.toggleNode.querySelector(".xpopover-template");return template?template.content.cloneNode(!0):null}},touch:null,handlers:{onLeave:function(event){window.JxPopover.isMobile()||(event=event||window.event,--this.delayedHide.cnt,this.delayedHide())},onEnter:function(event){window.JxPopover.isMobile()||(event=event||window.event,++this.delayedHide.cnt,this.delayedHide())},onTouchStart:function(event){if(window.JxPopover.isMobile()){let target=(event=event||window.event).target||event.srcElement;if(target){let scroll=target.closest(".scrollbar");if(scroll&&scroll.scrollTop)return}event.changedTouches&&event.changedTouches.length&&(this.touch=event.changedTouches[0],this.touch.time=(new Date).getTime())}},onTouchMove:function(event){if(window.JxPopover.isMobile()&&(event=event||window.event).changedTouches&&event.changedTouches.length&&this.touch){let touch,bottom=event.changedTouches[0].screenY-this.touch.screenY;bottom>=0&&this.node.style.setProperty("bottom",`-${bottom}px`,"important")}},onTouchEnd:function(event){if(window.JxPopover.isMobile()&&(event=event||window.event).changedTouches&&event.changedTouches.length&&this.touch){let touch,bottom=event.changedTouches[0].screenY-this.touch.screenY,height=this.node.clientHeight,time,speed=((new Date).getTime()-this.touch.time)/bottom;if(bottom>0&&(bottom>=100||bottom>height/2||speed<2))return this.node.style.setProperty("transform","translate(0,100%)","important"),void setTimeout(()=>{this.hide()},300);this.node.style.bottom="",this.touch=null}},onTouchCancel:function(event){window.JxPopover.isMobile()&&(event=event||window.event,this.node.style.bottom="",this.touch=null)}},addOverlay:function(){!this.overlay&&this.node&&(this.overlay=BX.create({tag:"div",attrs:{class:"xpopover-overlay"}}),this.node.parentNode.insertBefore(this.overlay,this.node),this.overlay.xpopover=this,this.fixBody())},removeOverlay:function(){this.overlay&&(this.unfixBody(),this.overlay.remove(),this.overlay=null)},fixBody:function(){let diffWidth=window.innerWidth-document.documentElement.clientWidth;diffWidth&&(document.body.style.paddingRight=diffWidth+"px"),document.body.style.height="100vh",document.body.style.overflow="hidden"},unfixBody:function(){document.body.style.paddingRight="",document.body.style.height="",document.body.style.overflow=""}},window.JxPopover.handlers={onToggleNodeClick:function(event){event=event||window.event;let toggleNode=this.closest("[data-xpopover]"),popover=JxPopover.get(toggleNode);popover&&(-1!==popover.trigger.indexOf("click")||window.JxPopover.isMobile()||window.JxPopover.isTouch())&&(event.preventDefault(),popover.toggle())},onDocOver:function(event){if(window.JxPopover.isTouch())return;let target=(event=event||window.event).target;if(target){let toggleNode=target.closest("[data-xpopover]"),popover=JxPopover.get(toggleNode);if(popover&&-1!==popover.trigger.indexOf("hover")&&!popover.visible){if(window.JxPopover.handlers.onDocOver.timer&&window.JxPopover.handlers.onDocOver.toggleNode&&!window.JxPopover.handlers.onDocOver.toggleNode.isEqualNode(toggleNode)&&(clearTimeout(window.JxPopover.handlers.onDocOver.timer),window.JxPopover.handlers.onDocOver.timer=!1),!window.JxPopover.handlers.onDocOver.timer){window.JxPopover.handlers.onDocOver.toggleNode=toggleNode;let toggleNodePosition=toggleNode.getBoundingClientRect();window.JxPopover.handlers.onDocOver.timer=setTimeout((function(){window.JxPopover.handlers.onDocOver.timer=!1;let toggleNodePositionNew=popover.toggleNode.getBoundingClientRect();toggleNodePosition.top==toggleNodePositionNew.top&&toggleNodePosition.left==toggleNodePositionNew.left&&popover.show()}),1e3)}return}}window.JxPopover.handlers.onDocOver.timer&&(clearTimeout(window.JxPopover.handlers.onDocOver.timer),window.JxPopover.handlers.onDocOver.timer=!1)},onOverlayClick:function(event){let target=(event=event||window.event).target;if(target){let popover=target.xpopover;void 0!==popover&&popover&&popover instanceof JxPopover?popover.hide():target.remove()}},onDocClick:function(event){let target=(event=event||window.event).target;if(target){let toggleNode,overlay,popover;if(target.closest(".xpopover-toggle"))return;if(target.closest(".xpopover-overlay"))return;if(target.closest(".xpopover"))return}window.JxPopover.hide()},onWindowResize:function(event){window.JxPopover.isMobile()||window.JxPopover.hide()}},window.JxPopover.get=function(toggleNode){if(toggleNode){if(void 0===toggleNode.xpopover||!(toggleNode.xpopover instanceof JxPopover)){let options={},data=toggleNode.getAttribute("data-xpopover");if(data)try{options=JSON.parse(data)}catch(e){options={}}return new JxPopover(toggleNode,options)}return toggleNode.xpopover}return null},window.JxPopover.hide=function(){let visiblePopovers=document.querySelectorAll(".xpopover.show");visiblePopovers.length&&visiblePopovers.forEach(popover=>{void 0!==popover.xpopover&&popover.xpopover instanceof JxPopover&&popover.xpopover.hide()})},window.JxPopover.isMobile=function(){return window.matchMedia("(max-width: 380px)").matches||window.devicePixelRatio>=2&&window.matchMedia("(max-width: 760px)").matches},window.JxPopover.isTouch=function(){return document.documentElement.classList.contains("bx-touch")},window.JxPopover.bindEvents=function(){"function"==typeof window.JxPopover.handlers.onToggleNodeClick&&BX.bindDelegate(document,"click",{className:"xpopover-toggle"},window.JxPopover.handlers.onToggleNodeClick),window.JxPopover.isTouch()||"function"==typeof window.JxPopover.handlers.onDocOver&&BX.bind(document,"mouseover",window.JxPopover.handlers.onDocOver),"function"==typeof window.JxPopover.handlers.onDocClick&&BX.bind(document,"click",window.JxPopover.handlers.onDocClick),"function"==typeof window.JxPopover.handlers.onOverlayClick&&BX.bindDelegate(document,"click",{className:"xpopover-overlay"},window.JxPopover.handlers.onOverlayClick),"function"==typeof window.JxPopover.handlers.onWindowResize&&(window.onresize=window.JxPopover.handlers.onWindowResize)},window.JxPopover.bindEvents());