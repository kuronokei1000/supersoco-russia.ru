function checkCounters(name){return void 0!==name?"google"==name&&"Y"==arAsproOptions.COUNTERS.GOOGLE_ECOMERCE&&arAsproOptions.COUNTERS.GOOGLE_COUNTER>0||"yandex"==name&&"Y"==arAsproOptions.COUNTERS.YANDEX_ECOMERCE&&arAsproOptions.COUNTERS.YANDEX_COUNTER>0:"Y"==arAsproOptions.COUNTERS.YANDEX_ECOMERCE&&arAsproOptions.COUNTERS.YANDEX_COUNTER>0||"Y"==arAsproOptions.COUNTERS.GOOGLE_ECOMERCE&&arAsproOptions.COUNTERS.GOOGLE_COUNTER>0}function waitLayer(delay,callback){"undefined"!=typeof dataLayer&&"function"==typeof callback?callback():setTimeout((function(){waitLayer(delay,callback)}),delay)}function addBasketCounter(id,callback){checkCounters()&&$.ajax({url:arAsproOptions.SITE_DIR+"ajax/goals.php",dataType:"json",type:"POST",data:{ID:id},success:function(item){if(item&&item.ID){let ecommerce={items:[{item_name:item.NAME,item_id:item.ID,price:parseFloat(item.PRICE),item_brand:item.BRAND,item_category:item.CATEGORY,item_list_name:"List Results",item_list_id:item.IBLOCK_SECTION_ID,affiliation:item.SHOP_NAME,index:1,quantity:parseFloat(item.QUANTITY)}]};"v3"===arAsproOptions.COUNTERS.GA_VERSION&&(ecommerce={currencyCode:item.CURRENCY,add:{products:[{id:item.ID,name:item.NAME,price:parseFloat(item.PRICE),brand:item.BRAND,category:item.CATEGORY,quantity:parseFloat(item.QUANTITY)}]}}),waitLayer(100,(function(){dataLayer.push({ecommerce:null}),dataLayer.push({event:arAsproOptions.COUNTERS.GOOGLE_EVENTS.ADD2BASKET,currency:item.CURRENCY,value:parseFloat(item.PRICE),ecommerce:ecommerce}),"function"==typeof callback&&callback()}))}}})}function delFromBasketCounter(id,callback){checkCounters()&&$.ajax({url:arAsproOptions.SITE_DIR+"ajax/goals.php",dataType:"json",type:"POST",data:{ID:id},success:function(item){if(item.ID){let ecommerce={items:[{item_name:item.NAME,item_id:item.ID,price:parseFloat(item.PRICE),item_brand:item.BRAND,item_category:item.CATEGORY,affiliation:item.SHOP_NAME,item_list_name:"List Results"}]};"v3"===arAsproOptions.COUNTERS.GA_VERSION&&(ecommerce={remove:{products:[{id:item.ID,name:item.NAME,category:item.CATEGORY}]}}),waitLayer(100,(function(){dataLayer.push({ecommerce:null}),dataLayer.push({event:arAsproOptions.COUNTERS.GOOGLE_EVENTS.REMOVE_BASKET,currency:item.CURRENCY,value:parseFloat(item.PRICE),ecommerce:ecommerce}),"function"==typeof callback&&callback()}))}}})}function viewItemCounter(id,price_id){checkCounters()&&$.ajax({url:arAsproOptions.SITE_DIR+"ajax/goals.php",dataType:"json",type:"POST",data:{PRODUCT_ID:id,PRICE_ID:price_id},success:function(item){if(item.ID){let ecommerce={items:[{item_name:item.NAME,item_id:item.ID,price:parseFloat(item.PRICE),item_brand:item.BRAND,item_category:item.CATEGORY,item_list_name:"List Results",item_list_id:item.IBLOCK_SECTION_ID,affiliation:item.SHOP_NAME,index:1,quantity:parseFloat(item.QUANTITY)}]};"v3"===arAsproOptions.COUNTERS.GA_VERSION&&(ecommerce={detail:{products:[{id:item.ID,name:item.NAME,price:parseFloat(item.PRICE),brand:item.BRAND,category:item.CATEGORY}]}}),waitLayer(100,(function(){dataLayer.push({ecommerce:null}),dataLayer.push({event:"view_item",currency:item.CURRENCY,value:parseFloat(item.PRICE),ecommerce:ecommerce})}))}}})}function purchaseCounter(order_id,type,callback){checkCounters()&&$.ajax({url:arAsproOptions.SITE_DIR+"ajax/goals.php",dataType:"json",type:"POST",data:{ORDER_ID:order_id,TYPE:type},success:function(order){var products=[];const items=[];if(order.ITEMS)for(var i in order.ITEMS)products.push({id:order.ITEMS[i].ID,sku:order.ITEMS[i].ID,name:order.ITEMS[i].NAME,price:order.ITEMS[i].PRICE,brand:order.ITEMS[i].BRAND,category:order.ITEMS[i].CATEGORY,quantity:order.ITEMS[i].QUANTITY}),items.push({item_id:order.ITEMS[i].ID,item_name:order.ITEMS[i].NAME,price:parseFloat(order.ITEMS[i].PRICE),item_brand:order.ITEMS[i].BRAND,item_category:order.ITEMS[i].CATEGORY,affiliation:order.SHOP_NAME,quantity:parseFloat(order.ITEMS[i].QUANTITY)});if(order.ID){let ecommerce={transaction_id:order.ACCOUNT_NUMBER,affiliation:order.SHOP_NAME,value:order.PRICE,tax:order.TAX_VALUE,shipping:order.PRICE_DELIVERY,currency:order.CURRENCY,items:items};"v3"===arAsproOptions.COUNTERS.GA_VERSION&&(ecommerce={purchase:{actionField:{id:order.ACCOUNT_NUMBER,shipping:order.PRICE_DELIVERY,tax:order.TAX_VALUE,list:type,revenue:order.PRICE},products:products}}),waitLayer(100,(function(){dataLayer.push({ecommerce:null}),dataLayer.push({event:arAsproOptions.COUNTERS.GOOGLE_EVENTS.PURCHASE,ecommerce:ecommerce}),void 0!==callback&&callback(ecommerce)}))}else void 0!==callback&&callback()},error:function(){void 0!==callback&&callback()}})}function checkoutCounter(step,option,callback){checkCounters("google")&&$.ajax({url:arAsproOptions.SITE_DIR+"ajax/goals.php",dataType:"json",type:"POST",data:{BASKET:"Y"},success:function(basket){var products=[];const items=[];let summ=0,currency="RUB";if(basket.ITEMS)for(var i in basket.ITEMS)products.push({id:basket.ITEMS[i].ID,name:basket.ITEMS[i].NAME,price:basket.ITEMS[i].PRICE,brand:basket.ITEMS[i].BRAND,category:basket.ITEMS[i].CATEGORY,quantity:basket.ITEMS[i].QUANTITY}),items.push({item_id:basket.ITEMS[i].ID,item_name:basket.ITEMS[i].NAME,price:parseFloat(basket.ITEMS[i].PRICE),item_brand:basket.ITEMS[i].BRAND,item_category:basket.ITEMS[i].CATEGORY,affiliation:basket.SHOP_NAME,quantity:parseFloat(basket.ITEMS[i].QUANTITY)}),summ+=basket.ITEMS[i].PRICE,currency=basket.ITEMS[i].CURRENCY;if(products){let ecommerce={items:items};"v3"===arAsproOptions.COUNTERS.GA_VERSION&&(ecommerce={checkout:{actionField:{step:step,option:option},products:products}}),waitLayer(100,(function(){dataLayer.push({ecommerce:null}),dataLayer.push({event:arAsproOptions.COUNTERS.GOOGLE_EVENTS.CHECKOUT_ORDER,currency:currency,value:parseFloat(summ),ecommerce:ecommerce}),void 0!==callback&&"function"==typeof callback&&callback()}))}}})}function waitCounter(idCounter,delay,callback){var obCounter;"object"==typeof window["yaCounter"+idCounter]?"function"==typeof callback&&callback():setTimeout((function(){waitCounter(idCounter,delay,callback)}),delay)}BX.addCustomEvent("onCounterGoals",(function(eventdata){if("object"!=typeof eventdata&&(eventdata={goal:"undefined"}),"string"!=typeof eventdata.goal&&(eventdata.goal="undefined"),"goal_basket_add"===eventdata.goal?"object"==typeof eventdata.params&&eventdata.params&&eventdata.params.id&&addBasketCounter(eventdata.params.id):"goal_basket_remove"===eventdata.goal&&"object"==typeof eventdata.params&&eventdata.params&&eventdata.params.id&&delFromBasketCounter(eventdata.params.id),"Y"===arAsproOptions.THEME.YA_GOALS&&arAsproOptions.THEME.YA_COUNTER_ID){var idCounter=arAsproOptions.THEME.YA_COUNTER_ID;if(idCounter=parseInt(idCounter))try{waitCounter(idCounter,50,(function(){var obCounter=window["yaCounter"+idCounter];"object"==typeof obCounter&&obCounter.reachGoal(eventdata.goal)}))}catch(e){console.error(e)}else console.info("Bad counter id!",idCounter)}})),readyDOM((function(){"Y"===arAsproOptions.THEME.USE_DEBUG_GOALS?$.cookie("_ym_debug","1"):$.cookie("_ym_debug",null)}));