void 0===window.JBigData&&(window.JBigData=function(config){config="object"==typeof config&&config?config:{};var _private={inited:!1};let _config=JSON.stringify(config);Object.defineProperties(this,{inited:{get:function(){return _private.inited},set:function(value){value&&(_private.inited=!0)}},config:{get:function(){return JSON.parse(_config)}}}),this.valid&&this.init()},window.JBigData.prototype={nodes:{wrapper:null,block:null},get valid(){let bigData=this.config.bigData;return bigData&&"object"==typeof bigData&&!(bigData instanceof Array)},get data(){if(this.valid){let bigData=this.config.bigData;return BX.ajax.prepareData(bigData.params)}return null},get rcmLoadUrl(){let url="https://analytics.bitrix.info/crecoms/v1_0/recoms.php",data=this.data;return data&&(url+=(-1!==url.indexOf("?")?"&":"?")+data),url},get catalogLoadUrl(){return arAsproOptions.SITE_DIR+"ajax/catalog_section.php"+(-1!==document.location.href.indexOf("clear_cache=Y")?"?clear_cache=Y":"")},init:function(){this.inited||(this.inited=!0,this.nodes.wrapper=document.querySelector(".bigdata-wrapper"),this.nodes.wrapper&&(this.nodes.block=this.nodes.wrapper.closest(".personal__main-block")||this.nodes.wrapper.closest(".personal__block")),this.rcmLoad(BX.proxy((function(result){this.onRcmReady(result)}),this),BX.proxy((function(result){this.onRcmReady(result)}),this)))},rcmLoad:function(onSuccess,onFailure){if(this.valid){let bigData=this.config.bigData;BX.cookie_prefix=bigData.js.cookiePrefix||"",BX.cookie_domain=bigData.js.cookieDomain||"",BX.current_server_time=bigData.js.serverTime;let ajaxConfig={url:this.rcmLoadUrl,method:"GET",dataType:"json",timeout:3};onSuccess&&"function"==typeof onSuccess&&(ajaxConfig.onsuccess=onSuccess),onFailure&&"function"==typeof onFailure&&(ajaxConfig.onfailure=onFailure),BX.ajax(ajaxConfig)}},onRcmReady:function(result){let count=this.config.count>0?this.config.count:10,data={action:"deferredLoad",bigData:"Y",items:result&&result.items||[],rid:result&&result.id,count:count,rowsRange:[count],shownIds:this.config.bigData&&this.config.bigData.shownIds||[],siteId:this.config.siteId,template:this.config.template,parameters:this.config.parameters};this.catalogLoad(data)},catalogLoad:function(data){data&&"object"==typeof data&&this.nodes.wrapper&&(this.nodes.wrapper.classList.add("form","sending"),BX.ajax({url:this.catalogLoadUrl,method:"POST",dataType:"json",timeout:60,data:data,onsuccess:BX.proxy((function(result){if(this.show(),this.nodes.wrapper.classList.remove("form","sending"),!result||"object"!=typeof result||"string"!=typeof result.JS||"string"!=typeof result.items||!result.items)return void this.remove();let obData=BX.processHTML(result.items),html=obData.HTML;this.nodes.wrapper.innerHTML=html,"function"==typeof InitAppear&&InitAppear(),BX.ajax.processScripts(obData.SCRIPT),obData=BX.processHTML(result.JS),BX.ajax.processScripts(obData.SCRIPT),BX.onCustomEvent("onCompleteAction",[{action:"ajaxContentLoaded"},this.nodes.wrapper])}),this),onfailure:BX.proxy((function(){this.nodes.wrapper.classList.remove("form","sending")}),this)}))},remove:function(){this.nodes.block?this.nodes.block.remove():this.nodes.wrapper&&this.nodes.wrapper.remove()},show:function(){if(this.nodes.block){let block=this.nodes.block.querySelector(".personal__block");block&&block.classList.remove("hidden")}}},window.JBigData.getCookie=function(name){var matches=document.cookie.match(new RegExp("(?:^|; )"+name.replace(/([\.$?*|{}\(\)\[\]\\\/\+^])/g,"\\$1")+"=([^;]*)"));return matches?decodeURIComponent(matches[1]):null},window.JBigData.rememberProductRecommendation=function(rcmId,productId){if(productId>0){rcmId=rcmId||"mostviewed";const cookieName=BX.cookie_prefix+"_RCM_PRODUCT_LOG";let cookie=window.JBigData.getCookie(cookieName),itemFound=!1,cItems=[],cItem;cookie&&(cItems=cookie.split("."));let i=cItems.length;for(;i--;)cItem=cItems[i].split("-"),cItem[0]==productId?(cItem=cItems[i].split("-"),cItem[1]=rcmId,cItem[2]=BX.current_server_time,cItems[i]=cItem.join("-"),itemFound=!0):BX.current_server_time-cItem[2]>2592e3&&cItems.splice(i,1);itemFound||cItems.push([productId,rcmId,BX.current_server_time].join("-"));let plNewCookie=cItems.join("."),cookieDate=new Date((new Date).getTime()+31536e7).toUTCString();document.cookie=cookieName+"="+plNewCookie+"; path=/; expires="+cookieDate+"; domain="+BX.cookie_domain}},BX.bind(document,"click",(function(event){let target=(event=event||window.event).target;if(target){let wrapperItem=target.closest("[data-bigdata]");if(wrapperItem&&(target.closest("a")||target.closest('[data-event="jqm"]')||target.closest(".item-action"))){let rcmId=wrapperItem.dataset.rcm,infoItem=wrapperItem.querySelector("[data-id][data-item]");if(infoItem){let productId=infoItem.dataset.id;window.JBigData.rememberProductRecommendation(rcmId,productId)}}}})));