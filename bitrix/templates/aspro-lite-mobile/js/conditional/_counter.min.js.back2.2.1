$(document).on("click",".counter__action--plus",(function(){if($(this).closest(".counter--basket").length)return;let $input=$(this).closest(".counter").find(".counter__count"),currentValue=$input.val(),$buyBlock,$toCart=$(this).closest(".buy_block").find(".item-action .to_cart"),isFloatRatio=$toCart.data("float_ratio"),ratio=$toCart.data("ratio");ratio=isFloatRatio?parseFloat(ratio):parseInt(ratio,10),isFloatRatio&&(ratio=Math.round(ratio*arAsproOptions.JS_ITEM_CLICK.precisionFactor)/arAsproOptions.JS_ITEM_CLICK.precisionFactor);let newValue=isFloatRatio?parseFloat(currentValue):parseInt(currentValue,10);newValue+=ratio,isFloatRatio&&(newValue=Math.round(newValue*arAsproOptions.JS_ITEM_CLICK.precisionFactor)/arAsproOptions.JS_ITEM_CLICK.precisionFactor);let maxValue=parseFloat($(this).data("max"));parseFloat(maxValue)>0?$input.val()<maxValue&&(newValue<=maxValue&&$input.val(newValue),$input.change()):($input.val(newValue),$input.change())})),$(document).on("click",".counter__action--minus",(function(){if($(this).closest(".counter--basket").length)return;let $input=$(this).closest(".counter").find(".counter__count"),currentValue=$input.val(),$buyBlock,$toCart=$(this).closest(".buy_block").find(".item-action .to_cart"),isFloatRatio=$toCart.data("float_ratio"),ratio=$toCart.data("ratio");ratio=isFloatRatio?parseFloat(ratio):parseInt(ratio,10),isFloatRatio&&(ratio=Math.round(ratio*arAsproOptions.JS_ITEM_CLICK.precisionFactor)/arAsproOptions.JS_ITEM_CLICK.precisionFactor);let newValue=isFloatRatio?parseFloat(currentValue):parseInt(currentValue,10);newValue-=ratio,isFloatRatio&&(newValue=Math.round(newValue*arAsproOptions.JS_ITEM_CLICK.precisionFactor)/arAsproOptions.JS_ITEM_CLICK.precisionFactor);let minValue=parseFloat($(this).data("min"));minValue&&!ratio&&(ratio=minValue);let maxValue=$(this).closest(".counter").find(".counter__action--plus").data("max");parseFloat(maxValue)>0?currentValue>ratio&&(newValue<ratio?$input.val(ratio):$input.val(newValue)):newValue>ratio?$input.val(newValue):0===parseFloat(newValue)?$input.val(newValue):ratio?$input.val(ratio):currentValue>1&&$input.val(newValue),$input.change()})),$(document).on("focus",".counter__count",(function(e){$(this).addClass("focus")})),$(document).on("blur",".counter__count",(function(e){$(this).removeClass("focus")}));let timerChangeCounterValue=!1;$(document).on("change",".counter__count",(function(e){if($(this).closest(".counter--basket").length)return;let currentValue=$(this).val(),$buyBlock,$toCart=$(this).closest(".buy_block").find(".item-action .to_cart"),isFloatRatio=$toCart.data("float_ratio"),ratio=$toCart.data("ratio");ratio=isFloatRatio?parseFloat(ratio):parseInt(ratio,10);let diff=currentValue%ratio;isFloatRatio&&(ratio=Math.round(ratio*arAsproOptions.JS_ITEM_CLICK.precisionFactor)/arAsproOptions.JS_ITEM_CLICK.precisionFactor,Math.round(diff*arAsproOptions.JS_ITEM_CLICK.precisionFactor)/arAsproOptions.JS_ITEM_CLICK.precisionFactor==ratio&&(diff=0)),$(this).hasClass("focus")&&(intCount=Math.round(Math.round(currentValue*arAsproOptions.JS_ITEM_CLICK.precisionFactor/ratio)/arAsproOptions.JS_ITEM_CLICK.precisionFactor)||1,0!==parseFloat(currentValue)&&(currentValue=intCount<=1?ratio:intCount*ratio),currentValue=Math.round(currentValue*arAsproOptions.JS_ITEM_CLICK.precisionFactor)/arAsproOptions.JS_ITEM_CLICK.precisionFactor);let maxValue=$(this).closest(".counter").find(".counter__action--plus").data("max");parseFloat(maxValue)>0&&currentValue>parseFloat(maxValue)&&(currentValue=parseFloat(maxValue));let minValue=$(this).closest(".counter").find(".counter__action--minus").data("min");if(parseFloat(minValue)>0&&currentValue<parseFloat(minValue)&&(currentValue=parseFloat(minValue)),timerChangeCounterValue&&clearTimeout(timerChangeCounterValue),0===parseFloat(currentValue)){let itemAction=JItemAction.factory($toCart[0]);return itemAction.state=!1,itemAction.resetQuantity(),BX.onCustomEvent("onCounterGoals",[{goal:itemAction.getStateGoalCode(!1),params:{id:itemAction.node.getAttribute("data-id")}}]),"function"==typeof JNoticeSurface&&JNoticeSurface.get().node.remove(),itemAction.updateState()}currentValue<ratio?currentValue=ratio:parseFloat(currentValue)||(currentValue=1),$toCart.attr("data-quantity",currentValue),$(this).val(currentValue),timerChangeCounterValue=setTimeout((function(){JItemAction.factory($toCart[0]).updateState(),timerChangeCounterValue=!1}),700),BX.onCustomEvent("onCounterProductAction",[{type:"change",params:{id:$(this),value:currentValue}}]),$(this).closest(".complect-block").length&&"function"==typeof setNewPriceComplect&&setNewPriceComplect()}));